<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Qu·∫£n l√Ω Email Online - Auto Filter</title>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
<style>
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(to right, #e3f2fd, #f5f5f5);
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 30px 10px;
  color: #333;
}
.container {
  background: white;
  border-radius: 16px;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
  padding: 30px 20px;
  max-width: 420px;
  width: 100%;
  display: flex;
  flex-direction: column;
  gap: 16px;
  transition: all 0.3s ease;
}
h3 {
  margin-bottom: 12px;
  color: #007bff;
  text-align: center;
}
textarea, input, button {
  font-size: 16px;
  width: 100%;
  padding: 12px;
  border-radius: 8px;
  border: 1px solid #ccc;
  box-sizing: border-box;
  transition: all 0.2s ease;
}
textarea:focus, input:focus {
  outline: none;
  border-color: #007bff;
  box-shadow: 0 0 0 2px rgba(0,123,255,0.25);
}
button {
  background: #007bff;
  color: white;
  border: none;
  cursor: pointer;
  font-weight: 600;
  transition: background 0.3s;
}
button:hover {
  background: #0056b3;
}
#deleteListButton {
  background: #dc3545;
}
#deleteListButton:hover {
  background: #a71d2a;
}
#copyButton {
  font-size: 18px;
  padding: 16px;
  background: #28a745;
  width: 100%;
}
#copyButton:hover {
  background: #1c7c31;
}
.input-container {
  display: flex;
  gap: 10px;
  align-items: center;
}
#manualCopyButton {
  max-width: 60px;
  padding: 10px;
}
#output, #count {
  font-size: 14px;
  color: #555;
  text-align: center;
}
</style>
</head>
<body>
<div class="container">
  <h3>üì® Qu·∫£n l√Ω danh s√°ch Email Online (T·ª± L·ªçc & L∆∞u)</h3>

  <textarea id="emailListInput" placeholder="D√°n email, text r√°c, ph√¢n c√°ch b·∫•t k·ª≥ (| ; , space ...)"></textarea>
  <button id="addListButton">‚ûï Th√™m Email V√†o Danh S√°ch</button>
  <button id="deleteListButton">üóëÔ∏è X√≥a Danh S√°ch Email</button>

  <div class="input-container">
    <input type="text" id="emailOutput" placeholder="Email s·∫Ω xu·∫•t hi·ªán ·ªü ƒë√¢y" readonly>
    <button id="manualCopyButton">üìã</button>
  </div>

  <p id="count"></p>
  <p id="output"></p>

  <button id="copyButton">üìã L·∫•y & Copy Email</button>
</div>

<script>
// === Firebase Config ==='
const firebaseConfig = {
  apiKey: "AIzaSyBIM03NvXqLagUrat91gyQHadSFN9-M4-w",
  authDomain: "sync-mail-tool-cbd23.firebaseapp.com",
  databaseURL: "https://sync-mail-tool-cbd23-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "sync-mail-tool-cbd23",
  storageBucket: "sync-mail-tool-cbd23.firebasestorage.app",
  messagingSenderId: "872589917482",
  appId: "1:872589917482:web:a7682e1453f8ab2e81f253"
};


// ƒêi·ªÅn firebaseConfig ·ªü ƒë√¢y tr∆∞·ªõc khi ch·∫°y
// const firebaseConfig = { ... };

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const emailRef = db.ref('emails');
let emailList = [];

function extractEmails(text) {
  const separators = /[\s,;|]+/;
  const parts = text.split(separators);
  const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
  const emailSet = new Set();
  parts.forEach(item => {
    const cleaned = item.trim();
    if (emailRegex.test(cleaned)) {
      emailSet.add(cleaned.toLowerCase());
    }
  });
  return Array.from(emailSet);
}

function updateCount() {
  document.getElementById('count').textContent = `üìä S·ªë email c√≤n l·∫°i: ${emailList.length}`;
}

function copyText(text) {
  if (navigator.clipboard && window.isSecureContext) {
    navigator.clipboard.writeText(text).then(() => {
      document.getElementById('output').textContent = `‚úÖ ƒê√£ copy: ${text}`;
    }).catch(() => fallbackCopy(text));
  } else fallbackCopy(text);
}
function fallbackCopy(text) {
  const textarea = document.createElement("textarea");
  textarea.value = text;
  textarea.style.position = "fixed";
  textarea.style.left = "-9999px";
  document.body.appendChild(textarea);
  textarea.focus();
  textarea.select();
  try {
    const successful = document.execCommand('copy');
    document.getElementById('output').textContent = successful ? `‚úÖ ƒê√£ copy: ${text}` : '‚ö†Ô∏è Kh√¥ng th·ªÉ copy.';
  } catch {
    document.getElementById('output').textContent = '‚ö†Ô∏è L·ªói khi copy.';
  }
  document.body.removeChild(textarea);
}

emailRef.on('value', snapshot => {
  const data = snapshot.val();
  emailList = data ? data : [];
  updateCount();
});

document.getElementById('addListButton').addEventListener('click', () => {
  const input = document.getElementById('emailListInput').value.trim();
  const filteredEmails = extractEmails(input);
  if (filteredEmails.length === 0) {
    document.getElementById('output').textContent = '‚ö†Ô∏è Kh√¥ng c√≥ email h·ª£p l·ªá ƒë·ªÉ th√™m.';
    return;
  }
  emailRef.transaction(currentList => {
    const updatedList = currentList ? currentList.slice() : [];
    filteredEmails.forEach(email => {
      if (!updatedList.includes(email)) {
        updatedList.push(email);
      }
    });
    return updatedList;
  }, (error, committed, snapshot) => {
    if (error) {
      document.getElementById('output').textContent = '‚ö†Ô∏è L·ªói khi th√™m email.';
    } else if (!committed) {
      document.getElementById('output').textContent = '‚ö†Ô∏è Kh√¥ng th·ªÉ th√™m email.';
    } else {
      const updatedList = snapshot.val() ? snapshot.val() : [];
      document.getElementById('output').textContent = `‚úÖ ƒê√£ th√™m ${filteredEmails.length} email h·ª£p l·ªá, t·ªïng: ${updatedList.length}.`;
      document.getElementById('emailListInput').value = '';
      emailList = updatedList;
      updateCount();
    }
  });
});

document.getElementById('deleteListButton').addEventListener('click', () => {
  if (!confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a to√†n b·ªô danh s√°ch email?")) return;
  emailRef.set([], (error) => {
    if (error) {
      document.getElementById('output').textContent = '‚ö†Ô∏è L·ªói khi x√≥a danh s√°ch.';
    } else {
      document.getElementById('output').textContent = '‚úÖ ƒê√£ x√≥a to√†n b·ªô danh s√°ch email.';
      emailList = [];
      updateCount();
    }
  });
});

document.getElementById('manualCopyButton').addEventListener('click', () => {
  const email = document.getElementById('emailOutput').value;
  if (!email) {
    document.getElementById('output').textContent = '‚ö†Ô∏è Kh√¥ng c√≥ email ƒë·ªÉ copy.';
    return;
  }
  copyText(email);
});

document.getElementById('copyButton').addEventListener('click', () => {
  const copyButton = document.getElementById('copyButton');
  copyButton.disabled = true;
  copyButton.textContent = "‚è≥ ƒêang x·ª≠ l√Ω...";

  if (emailList.length === 0) {
    document.getElementById('output').textContent = '‚úÖ Danh s√°ch ƒë√£ h·∫øt email.';
    copyButton.disabled = false;
    copyButton.textContent = "üìã L·∫•y & Copy Email";
    return;
  }

  const randomIndex = Math.floor(Math.random() * emailList.length);
  const email = emailList[randomIndex];
  copyText(email);

  emailRef.transaction(currentList => {
    if (!currentList) return null;
    const idx = currentList.indexOf(email);
    if (idx !== -1) {
      currentList.splice(idx, 1);
    }
    return currentList;
  }, (error, committed, snapshot) => {
    if (error) {
      document.getElementById('output').textContent = '‚ö†Ô∏è L·ªói khi x√≥a email.';
    } else if (committed) {
      document.getElementById('emailOutput').value = email;
      emailList = snapshot.val() || [];
      updateCount();
    }
    copyButton.disabled = false;
    copyButton.textContent = "üìã L·∫•y & Copy Email";
  });
});
</script>
</body>
</html>
