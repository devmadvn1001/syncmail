<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Quản Lý Danh Sách Email</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <style>
    body { font-family: Arial; background: #f1f2f5; text-align: center; padding: 40px; }
    input, button { font-size: 18px; padding: 10px; border-radius: 8px; margin: 5px; }
    .alert { padding: 12px; background: #f44336; color: white; border-radius: 6px; margin: 10px auto; width: fit-content; }
    .success { background: #4CAF50; }
  </style>
</head>
<body>

<h2>📋 Quản lý danh sách Email Online</h2>

<textarea id="emailInput" rows="4" cols="40" placeholder="Nhập email (mỗi dòng 1 cái)"></textarea><br>
<button onclick="addEmails()">➕ Thêm Email Vào Danh Sách</button>
<button onclick="deleteAllEmails()" style="background: #e74c3c; color: white;">🗑️ Xóa Danh Sách Email</button><br><br>

<input id="outputEmail" placeholder="Email sẽ xuất hiện ở đây" readonly />
<button onclick="getAndCopy()">📋 Lấy & Copy Email</button>

<div id="alertBox" class="alert" style="display:none;"></div>

<script>
  // ✅ Cấu hình Firebase đúng dạng "compat"
  const firebaseConfig = {
    apiKey: "AIzaSyCa3FEO0GEir14Vh1939tZmAQBI3AD9ZTo",
    authDomain: "sync-mail-8860a.firebaseapp.com",
    databaseURL: "https://sync-mail-8860a-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "sync-mail-8860a",
    storageBucket: "sync-mail-8860a.appspot.com",
    messagingSenderId: "861437887101",
    appId: "1:861437887101:web:ba43e479ed9907e4902714"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const emailsRef = db.ref("emails");

  function showAlert(message, success = false) {
    const box = document.getElementById("alertBox");
    box.innerText = message;
    box.className = success ? "alert success" : "alert";
    box.style.display = "block";
    setTimeout(() => { box.style.display = "none"; }, 3000);
  }

  function addEmails() {
    const rawInput = document.getElementById("emailInput").value;
    if (!rawInput.trim()) return showAlert("Vui lòng nhập email.");
    const newEmails = rawInput.split('\n').map(e => e.trim()).filter(e => e);

    emailsRef.transaction(currentList => {
      const list = currentList || [];
      newEmails.forEach(email => {
        if (!list.includes(email)) list.push(email);
      });
      return list;
    }, (error, committed) => {
      if (error || !committed) return showAlert("⚠️ Lỗi khi thêm email.");
      showAlert("✅ Đã thêm email!", true);
    });
  }

  function deleteAllEmails() {
    emailsRef.set([], error => {
      if (error) return showAlert("⚠️ Lỗi khi xóa danh sách.");
      showAlert("✅ Đã xoá toàn bộ danh sách!", true);
    });
  }

  function getAndCopy() {
    emailsRef.transaction(currentList => {
      if (!currentList || currentList.length === 0) return;
      const index = Math.floor(Math.random() * currentList.length);
      const email = currentList[index];
      currentList.splice(index, 1);
      document.getElementById("outputEmail").value = email;
      navigator.clipboard.writeText(email);
      return currentList;
    }, (error, committed, snapshot) => {
      if (error || !committed) return showAlert("⚠️ Không thể lấy email.");
      showAlert("📋 Đã copy email!", true);
    });
  }
</script>

</body>
</html>
